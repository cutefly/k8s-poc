# Configure Network Ports and EntryPoints
# We will route with Gateway API instead.
ingressClass:
  enabled: false

# EntryPoints are the network listeners for incoming traffic.
ports:
  # Defines the HTTP entry point named 'web'
  web:
    port: 8000
    nodePort: 30080
    exposedPort: 8000
    # Instructs this entry point to redirect all traffic to the 'websecure' entry point
    #redirections:
    #  entryPoint:
    #    to: websecure
    #    scheme: https
    #    permanent: true
    forwardedHeaders:
      # -- Trust forwarded headers information (X-Forwarded-*).
      trustedIPs:
        - 192.168.219.0/24

  # Defines the HTTPS entry point named 'websecure'
  websecure:
    port: 8443
    nodePort: 30443
    exposedPort: 8443

service:
  spec:
    type: NodePort
    # -- Additional entries here will be added to the service spec.
    # -- Cannot contain type, selector or ports entries.
    externalTrafficPolicy: Local

# Enables the dashboard in Secure Mode
api:
  dashboard: true
  insecure: true

ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`traefik.club012.com`)
    entryPoints:
      - web
    middlewares:
      - name: dashboard-auth

# Creates a BasiAuth Middleware and Secret for the Dashboard Security
extraObjects:
  - apiVersion: v1
    kind: Secret
    metadata:
      name: dashboard-auth-secret
    type: kubernetes.io/basic-auth
    stringData:
      username: admin
      password: "P@ssw0rd"      # Replace with an Actual Password
  - apiVersion: traefik.io/v1alpha1
    kind: Middleware
    metadata:
      name: dashboard-auth
    spec:
      basicAuth:
        secret: dashboard-auth-secret

# Enable Gateway API Provider & Disables the KubernetesIngress provider
# Providers tell Traefik where to find routing configuration.
providers:
  kubernetesIngress:
     enabled: false
  kubernetesGateway:
     enabled: true

## Gateway Listeners
gateway:
  # -- Additional gateway annotations (e.g. for cert-manager.io/issuer)
  annotations:
    cert-manager.io/issuer: "letsencrypt-prod" # Directs cert-manager to this Gateway
  # -- Define listeners
  listeners:
    web:           # HTTP listener that matches entryPoint `web`
      port: 8000
      protocol: HTTP
      namespacePolicy:
        from: All

    websecure:         # HTTPS listener that matches entryPoint `websecure`
      port: 8443
      protocol: HTTPS  # TLS terminates inside Traefik
      namespacePolicy:
        from: All
      # tls를 발급하여 사용하는 경우
      # -- Optional hostname. See [Hostname](https://gateway-api.sigs.k8s.io/reference/spec/#gateway.networking.k8s.io/v1.Hostname)
      hostname: "club012.com"
      # -- Add certificates for TLS or HTTPS protocols. See [GatewayTLSConfig](https://gateway-api.sigs.k8s.io/reference/spec/#gateway.networking.k8s.io%2fv1.GatewayTLSConfig)
      certificateRefs:
      - name: club012-com-tls
      # -- TLS behavior for the TLS session initiated by the client. See [TLSModeType](https://gateway-api.sigs.k8s.io/reference/spec/#gateway.networking.k8s.io/v1.TLSModeType).
      mode: Terminate
      # 생성된 tls가 있는 경우
      #certificateRefs:
      #- kind: Secret
      #  name: local-selfsigned-tls  # the Secret we created before the installation
      #  group: ""

# Enable Observability
logs:
  general:
    level: INFO
  # This enables access logs, outputting them to Traefik's standard output by default. The [Access Logs Documentation](https://doc.traefik.io/traefik/observability/access-logs/) covers formatting, filtering, and output options.
  access:
    enabled: true

# Enables Prometheus for Metrics
metrics:
  prometheus:
    enabled: true
